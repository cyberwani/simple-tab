/*!
 * Tab Override jQuery Plugin v1.1
 * http://wjbryant.com/projects/tab-override/
 *
 * Copyright (c) 2011 Bill Bryant
 * Licensed under the MIT license
 * http://opensource.org/licenses/mit-license.php
 */
jQuery.fn.tabOverride=(function(e){var h="\t",b=false,f=document.createElement("textarea"),d,i,g;function c(A){var C=A.keyCode,k,x,q,r,w,l,n,B,t,j,u,v,m,s,y,p,z,o;if((C!==9&&(C!==13||!g.autoIndent))||A.ctrlKey||A.altKey){return}b=false;q=this.value;B=this.scrollTop;if(document.selection){r=document.selection.createRange();u=r.text;w=r.duplicate();w.moveToElementText(this);w.setEndPoint("EndToEnd",r);j=w.text.length;t=j-u.length;if(i>1){l=q.slice(0,t).split(d).length-1;n=u.split(d).length-1}else{l=n=0}}else{if(typeof this.selectionStart!=="undefined"){t=this.selectionStart;j=this.selectionEnd;u=q.slice(t,j)}else{return}}if(C===9){k=h;x=k.length;s=0;y=0;p=0;if(t!==j&&u.indexOf("\n")!==-1){if(t===0||q.charAt(t-1)==="\n"){v=t}else{v=q.lastIndexOf("\n",t-1)+1}if(j===q.length||q.charAt(j)==="\n"){m=j}else{m=q.indexOf("\n",j);if(m===-1){m=q.length}}if(A.shiftKey){if(q.slice(v).indexOf(k)===0){if(v===t){u=u.slice(x)}else{p=x}y=x}this.value=q.slice(0,v)+q.slice(v+p,t)+u.replace(new RegExp("\n"+k,"g"),function(){s+=1;return"\n"})+q.slice(j);if(r){r.collapse();r.moveEnd("character",j-y-(s*x)-n-l);r.moveStart("character",t-p-l);r.select()}else{this.selectionStart=t-p;this.selectionEnd=j-y-(s*x)}}else{s=1;this.value=q.slice(0,v)+k+q.slice(v,t)+u.replace(/\n/g,function(){s+=1;return"\n"+k})+q.slice(j);if(r){r.collapse();r.moveEnd("character",j+(s*x)-n-l);r.moveStart("character",t+x-l);r.select()}else{this.selectionStart=t+x;this.selectionEnd=j+(s*x);this.scrollTop=B}}}else{if(A.shiftKey){if(q.slice(t-x).indexOf(k)===0){this.value=q.slice(0,t-x)+q.slice(t);if(r){r.move("character",t-x-l);r.select()}else{this.selectionEnd=this.selectionStart=t-x;this.scrollTop=B}}}else{if(r){r.text=k;r.select()}else{this.value=q.slice(0,t)+k+q.slice(j);this.selectionEnd=this.selectionStart=t+x;this.scrollTop=B}}}}else{if(g.autoIndent){if(t===0||q.charAt(t-1)==="\n"){b=true;return}else{v=q.lastIndexOf("\n",t-1)+1}m=q.indexOf("\n",t);if(m===-1){m=q.length}z=q.slice(v,m).match(/^[ \t]*/)[0];o=z.length;if(t<v+o){b=true;return}if(r){r.text="\n"+z;r.select()}else{this.value=q.slice(0,t)+"\n"+z+q.slice(j);this.selectionEnd=this.selectionStart=t+i+o;this.scrollTop=B}}}A.preventDefault()}function a(k){var j=k.keyCode;if((j===9||(j===13&&g.autoIndent&&!b))&&!k.ctrlKey&&!k.altKey){k.preventDefault()}}g=function(j){this.each(function(){e(this).unbind(".tabOverride")});if(!arguments.length||j){this.each(function(){if(this.nodeName&&this.nodeName.toLowerCase()==="textarea"){e(this).bind("keydown.tabOverride",c).bind("keypress.tabOverride",a)}})}return this};g.getTabSize=function(){return h==="\t"?0:h.length};g.setTabSize=function(k){var j;if(!k){h="\t"}else{if(typeof k==="number"&&k>0){h="";for(j=0;j<k;j+=1){h+=" "}}}};g.autoIndent=false;f.value="\n";d=f.value;i=d.length;f=null;return g}(jQuery));